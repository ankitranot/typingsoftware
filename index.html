<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Typing Speed Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 20px;
    }
    textarea {
      width: 90%;
      height: 300px;
      font-size: 18px;
      padding: 10px;
      margin-top: 20px;
    }
    #stats {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
    }
    #resetBtn {
      margin-top: 15px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Typing Speed Test</h1>
  
  <label for="timeLimit">Set Time (seconds): </label>
  <input type="number" id="timeLimit" value="600" min="5" max="3600">

  <br><br>
  <textarea id="notepad" placeholder="Start typing here..."></textarea>
  
  <div id="stats">Time Left: 10:00 | Characters: 0</div>
  
  <button id="resetBtn">Reset</button>

  <audio id="typingSound" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>

  <script>
    let textarea = document.getElementById("notepad");
    let stats = document.getElementById("stats");
    let timeInput = document.getElementById("timeLimit");
    let resetBtn = document.getElementById("resetBtn");
    let typingSound = document.getElementById("typingSound");

    let timer;
    let timeLeft = 600; // default 10 min
    let charCount = 0;
    let started = false;
    let startTime = 0;

    function updateStats() {
      let minutes = Math.floor(timeLeft / 60);
      let seconds = timeLeft % 60;
      let formatted = `${minutes}:${seconds < 10 ? "0" + seconds : seconds}`;
      stats.textContent = `Time Left: ${formatted} | Characters: ${charCount}`;
    }

    function startTimer() {
      timer = setInterval(() => {
        if (timeLeft > 0) {
          timeLeft--;
          updateStats();
        } else {
          clearInterval(timer);
          endTest();
        }
      }, 1000);
    }

    function endTest() {
      textarea.disabled = true;
      typingSound.pause();
      typingSound.currentTime = 0;

      let timeTaken = (Date.now() - startTime) / 60000; // minutes
      let wpm = Math.floor((charCount / 5) / timeTaken);
      let result = wpm > 30 ? "✅ Passed" : "❌ Fail";

      alert(`Test Over!\nCharacters: ${charCount}\nTime Taken: ${timeTaken.toFixed(2)} mins\nWPM: ${wpm}\nResult: ${result}`);
    }

    textarea.addEventListener("input", () => {
      if (!started) {
        started = true;
        timeLeft = parseInt(timeInput.value) || 600;
        startTime = Date.now();
        startTimer();
        typingSound.loop = true;
        typingSound.play();
      }
      charCount = textarea.value.length;
      updateStats();
    });

    textarea.addEventListener("keydown", function(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        clearInterval(timer);
        endTest();
      }
    });

    resetBtn.addEventListener("click", resetNotepad);

    function resetNotepad() {
      clearInterval(timer);
      textarea.disabled = false;
      textarea.value = "";
      charCount = 0;
      timeLeft = parseInt(timeInput.value) || 600; // default 600 sec
      started = false;
      startTime = 0;
      updateStats();
    }

    // show default 10:00 stats at load
    window.onload = () => {
      timeLeft = parseInt(timeInput.value) || 600;
      updateStats();
    };
  </script>
</body>
</html>
